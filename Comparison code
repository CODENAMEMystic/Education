import UIKit

class ViewController: UIViewController {
    
    var people: NSArray = []
    var peopleIndex = 0
    @IBOutlet weak var Username: UILabel!
    @IBOutlet weak var email: UILabel!
    @IBOutlet weak var TeamName: UILabel!

    func getSheet(url: String) {
        let url = URL(string: url)
        
        let task = URLSession.shared.dataTask(with: url!) { data, response, error in
            guard error == nil else {
                print(error)
                return
            }
            
            guard let data = data else {
                print("Data is empty")
                return
            }
            
            let json =
                try! JSONSerialization.jsonObject(with: data, options: []) as! Dictionary<String, AnyObject>
            
            //callback(json)
            self.people = json["feed"]!["entry"] as! NSArray
            self.uiPump()
        }
        
        task.resume()
    }
    
    func uiPump() {
        let person = people[peopleIndex] as! Dictionary<String, AnyObject>
        let Username = person["gsx$username"]!["$t"]!
        let email = person["gsx$email"]!["$t"]!
        let TeamName = person["gsx$teamname"]!["$t"]!
        
        // instantly update the UI
        DispatchQueue.main.async(execute: {
            self.Username.text = Username  as? String
            self.email.text = email as? String
            self.TeamName.text = TeamName as? String
        })
    }
    
    override func viewDidLoad() {
        super.viewDidLoad()
        let sheet = "https://spreadsheets.google.com/feeds/list/1e_P5UsfO8hc48pE4Ltk22eu29m3-dn6IsIArB9V_Az0/od6/public/values?alt=json"
        getSheet(url: sheet)
    }
    
    @IBAction func btnPrev(_ sender: UIButton) {
        if peopleIndex == 0 {
            peopleIndex = people.count - 1
        } else {
            peopleIndex -= 1
        }
        print(peopleIndex)
        uiPump()
    }
    
    @IBAction func btnNext(_ sender: UIButton) {
        if peopleIndex == people.count - 1 {
            peopleIndex = 0
        } else {
            peopleIndex += 1
        }
        print(peopleIndex)
        uiPump()
    }
}
